syntax = "proto3";

package analytics;

// -------- Core Types --------

message PriceLevel {
  double price = 1;
  double volume = 2;
}

message Snapshot {
  string timestamp = 1;
  repeated PriceLevel bids = 2;
  repeated PriceLevel asks = 3;
  double mid_price = 4;
}

// -------- Output --------

message Anomaly {
  string type = 1;
  string severity = 2;
  string message = 3;
}

message ProcessedSnapshot {
  string timestamp = 1;
  double mid_price = 2;
  double spread = 3;
  double ofi = 4;
  double obi = 5;
  repeated Anomaly anomalies = 6;
  double microprice = 7;
  double divergence = 8;
  double directional_prob = 9;
  double vpin = 10;
  int32 regime = 11;
  string regime_label = 12;
  double best_bid = 13;
  double best_ask = 14;
  double q_bid = 15;
  double q_ask = 16;
  int32 gap_count = 17;
  double gap_severity_score = 18;
  double spoofing_risk = 19;
}

// -------- Service --------

service AnalyticsService {
  rpc ProcessSnapshot (Snapshot) returns (ProcessedSnapshot);
}
